Ãrbol de archivos del directorio: api
================================================================================

## ğŸŒ³ ESTRUCTURA DE ARCHIVOS

â”‚   â”œâ”€â”€ ğŸ“„ BugHunterSagaApiApplication.java
â”‚   â”œâ”€â”€ ğŸ“ application/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ dto/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ClaimTreasureCommand.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CompleteLessonCommand.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ForgotPasswordCommand.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetModuleProblemsQuery.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetModuleUnitQuery.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LoginUserCommand.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ PurchaseItemCommand.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ RegisterUserCommand.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UpdateUserAccountCommand.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UpdateUserSettingsCommand.java
â”‚   â”‚   â”œâ”€â”€ ğŸ“ port/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ in/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ClaimTreasureUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CompleteLessonUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ForgotPasswordUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetLeaderboardUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetModuleProblemsUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetModuleUnitUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetModulesUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetShopItemsUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetUserProfileUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetUserStatsUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LoginUserUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ PurchaseItemUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ RegisterUserUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UpdateUserAccountUseCase.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UpdateUserSettingsUseCase.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ out/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LeaderboardRepositoryPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LessonRepositoryPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ModuleRepositoryPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ PasswordEncoderPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ProblemRepositoryPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ShopItemRepositoryPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ TokenGeneratorPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ TransactionPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UnitRepositoryPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserLessonProgressRepositoryPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserProfileRepositoryPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserRepositoryPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserStreakRepositoryPort.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserXpHistoryRepositoryPort.java
â”‚   â”‚   â”œâ”€â”€ ğŸ“ service/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ClaimTreasureService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CompleteLessonService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ForgotPasswordService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetLeaderboardService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetModuleProblemsService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetModuleUnitService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetModulesService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetShopItemsService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetUserProfileService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetUserStatsService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LoginUserService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ PurchaseItemService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ RegisterUserService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UpdateUserAccountService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UpdateUserSettingsService.java
â”‚   â”œâ”€â”€ ğŸ“ domain/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ exception/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EmailAlreadyExistsException.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ InsufficientFundsException.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ InvalidCredentialsException.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LessonAlreadyCompletedException.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LessonNotFoundException.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ModuleNotFoundException.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ResourceNotFoundException.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ TreasureAlreadyClaimedException.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserNotFoundException.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UsernameAlreadyExistsException.java
â”‚   â”‚   â”œâ”€â”€ ğŸ“ model/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ AuthToken.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Leaderboard.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LeaderboardEntry.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Lesson.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Module.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Problem.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ShopItem.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Unit.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ User.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserLessonProgress.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserProfile.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserStreak.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserXpHistory.java
â”‚   â”œâ”€â”€ ğŸ“ infrastructure/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ config/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ BeanConfiguration.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ OpenAPIConfig.java
â”‚   â”‚   â”œâ”€â”€ ğŸ“ persistence/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ adapter/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LeaderboardRepositoryAdapter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LessonRepositoryAdapter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ModuleRepositoryAdapter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ProblemRepositoryAdapter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ShopItemRepositoryAdapter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ TransactionAdapter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UnitRepositoryAdapter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserLessonProgressRepositoryAdapter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserProfileRepositoryAdapter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserRepositoryAdapter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserStreakRepositoryAdapter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserXpHistoryRepositoryAdapter.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ entity/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LeagueEntity.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LessonEntity.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ModuleEntity.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ProblemEntity.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ShopItemEntity.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UnitEntity.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserEntity.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserLessonProgressEntity.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserLessonProgressId.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserProfileEntity.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserStreakEntity.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserStreakId.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserXpHistoryEntity.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ mapper/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ContentPersistenceMapper.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GamificationPersistenceMapper.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ProgressPersistenceMapper.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserPersistenceMapper.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ repository/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LeagueJpaRepository.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LessonJpaRepository.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ModuleJpaRepository.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ProblemJpaRepository.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ShopItemJpaRepository.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UnitJpaRepository.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserJpaRepository.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserLessonProgressJpaRepository.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserProfileJpaRepository.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserRepository.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserStreakJpaRepository.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserXpHistoryJpaRepository.java
â”‚   â”‚   â”œâ”€â”€ ğŸ“ security/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ adapter/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ JwtTokenGeneratorAdapter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ SpringPasswordEncoderAdapter.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ config/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ SecurityConfiguration.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ filter/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ JwtAuthenticationFilter.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ jwt/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ JwtUtil.java
â”‚   â”‚   â”œâ”€â”€ ğŸ“ web/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ controller/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ AuthController.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ContentController.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GamificationController.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ProgressController.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ SwaggerRedirectController.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserController.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ dto/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ AuthResponseDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ErrorDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ForgotPasswordDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LeaderboardDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LeaderboardEntryDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LessonCompletionResponseDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LessonResultDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LessonTileDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ModuleResponseDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ProblemDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ShopItemDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UnitDetailDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserAccountUpdateDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserInfoDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserLoginDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserProfileDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserRegistrationDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserSettingsUpdateDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserStatsDTO.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ exception/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GlobalApiExceptionHandler.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ mapper/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ AuthApiMapper.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ContentApiMapper.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GamificationApiMapper.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ProgressApiMapper.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserApiMapper.java


================================================================================
## ğŸ“„ CONTENIDO DETALLADO DE ARCHIVOS
================================================================================

================================================================================
ğŸ“„ CONTENIDO DE: BugHunterSagaApiApplication.java
================================================================================

package com.bughuntersaga.api;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class BugHunterSagaApiApplication {

    public static void main(String[] args) {
        SpringApplication.run(BugHunterSagaApiApplication.class, args);
    }

}


================================================================================
ğŸ“„ CONTENIDO DE: application/dto/ClaimTreasureCommand.java
================================================================================

    package com.bughuntersaga.api.application.dto;

    import lombok.Builder;
import lombok.Getter;


    @Getter
@Builder
    public class ClaimTreasureCommand {

    // TODO: Definir campos para el comando/query

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/dto/CompleteLessonCommand.java
================================================================================

    package com.bughuntersaga.api.application.dto;

    import lombok.Builder;
import lombok.Getter;


    @Getter
    @Builder
    public class CompleteLessonCommand {
        private final Integer lessonId;
        private final Integer correctAnswerCount;
        private final Integer incorrectAnswerCount;
        private final Long timeTakenMs;
        private final Boolean isPractice;

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/dto/ForgotPasswordCommand.java
================================================================================

    package com.bughuntersaga.api.application.dto;

    import lombok.Builder;
import lombok.Getter;


    @Getter
@Builder
    public class ForgotPasswordCommand {

    // TODO: Definir campos para el comando/query

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/dto/GetModuleProblemsQuery.java
================================================================================

    package com.bughuntersaga.api.application.dto;

    import lombok.Builder;
import lombok.Getter;


    @Getter
@Builder
    public class GetModuleProblemsQuery {

    // TODO: Definir campos para el comando/query

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/dto/GetModuleUnitQuery.java
================================================================================

    package com.bughuntersaga.api.application.dto;

    import lombok.Builder;
import lombok.Getter;


    @Getter
@Builder
    public class GetModuleUnitQuery {

    // TODO: Definir campos para el comando/query

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/dto/LoginUserCommand.java
================================================================================

    package com.bughuntersaga.api.application.dto;

    import lombok.Builder;
import lombok.Getter;


    @Getter
@Builder
    public class LoginUserCommand {

    // TODO: Definir campos para el comando/query

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/dto/PurchaseItemCommand.java
================================================================================

    package com.bughuntersaga.api.application.dto;

    import lombok.Builder;
import lombok.Getter;


    @Getter
@Builder
    public class PurchaseItemCommand {

    // TODO: Definir campos para el comando/query

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/dto/RegisterUserCommand.java
================================================================================
package com.bughuntersaga.api.application.dto;

import lombok.Builder;
import lombok.Getter;

@Getter
@Builder
public class RegisterUserCommand {
    private final String username;
    private final String name;
    private final String email;
    private final String rawPassword;
}


================================================================================
ğŸ“„ CONTENIDO DE: application/dto/UpdateUserAccountCommand.java
================================================================================

    package com.bughuntersaga.api.application.dto;

    import lombok.Builder;
import lombok.Getter;


    @Getter
@Builder
    public class UpdateUserAccountCommand {

    // TODO: Definir campos para el comando/query

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/dto/UpdateUserSettingsCommand.java
================================================================================

    package com.bughuntersaga.api.application.dto;

    import lombok.Builder;
import lombok.Getter;


    @Getter
@Builder
    public class UpdateUserSettingsCommand {

    // TODO: Definir campos para el comando/query

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/ClaimTreasureUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;



public interface ClaimTreasureUseCase {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/CompleteLessonUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;



public interface CompleteLessonUseCase {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/ForgotPasswordUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;



public interface ForgotPasswordUseCase {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/GetLeaderboardUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;



public interface GetLeaderboardUseCase {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/GetModuleProblemsUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;


import com.bughuntersaga.api.domain.model.Problem;

import java.util.List;

public interface GetModuleProblemsUseCase {

    List<Problem> getModuleProblems(String moduleName);

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/GetModuleUnitUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;


import com.bughuntersaga.api.domain.model.Unit;


public interface GetModuleUnitUseCase {

    Unit getModuleUnit(String moduleCode);

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/GetModulesUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;

import com.bughuntersaga.api.domain.model.Module;
import java.util.List;

public interface GetModulesUseCase {

    List<Module> getModules();

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/GetShopItemsUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;



public interface GetShopItemsUseCase {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/GetUserProfileUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;



public interface GetUserProfileUseCase {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/GetUserStatsUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;



public interface GetUserStatsUseCase {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/LoginUserUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;



public interface LoginUserUseCase {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/PurchaseItemUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;



public interface PurchaseItemUseCase {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/RegisterUserUseCase.java
================================================================================
package com.bughuntersaga.api.application.port.in;

import com.bughuntersaga.api.application.dto.RegisterUserCommand;
import com.bughuntersaga.api.domain.model.AuthToken;

public interface RegisterUserUseCase {
    AuthToken register(RegisterUserCommand command);
}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/UpdateUserAccountUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;



public interface UpdateUserAccountUseCase {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/in/UpdateUserSettingsUseCase.java
================================================================================

package com.bughuntersaga.api.application.port.in;



public interface UpdateUserSettingsUseCase {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/LeaderboardRepositoryPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;



public interface LeaderboardRepositoryPort {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/LessonRepositoryPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;


import com.bughuntersaga.api.domain.model.Lesson;

import java.util.List;
import java.util.Optional;

public interface LessonRepositoryPort {
    Optional<Lesson> findById(Integer id);
    List<Lesson> findByUnitId(Integer unitId);
}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/ModuleRepositoryPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;

import com.bughuntersaga.api.domain.model.Module;
import java.util.List;
import java.util.Optional;

/**
 * Puerto para el repositorio de mÃ³dulos.
 */
public interface ModuleRepositoryPort {
    List<Module> findAll();
    Optional<Module> findById(Integer id);
    Optional<Module> findByCode(String code);
}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/PasswordEncoderPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;



public interface PasswordEncoderPort {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/ProblemRepositoryPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;


import com.bughuntersaga.api.domain.model.Problem;

import java.util.List;
import java.util.Optional;

/**
 * Puerto para el repositorio de problemas.
 */
public interface ProblemRepositoryPort {
    List<Problem> findProblemsByModuleCode(String moduleCode);
    Optional<Problem> findById(Integer id);
    List<Problem> findByLessonId(Integer lessonId);
}

================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/ShopItemRepositoryPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;



public interface ShopItemRepositoryPort {

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/TokenGeneratorPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;



public interface TokenGeneratorPort {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/TransactionPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;



public interface TransactionPort {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/UnitRepositoryPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;


import com.bughuntersaga.api.domain.model.Unit;

import java.util.List;
import java.util.Optional;

public interface UnitRepositoryPort {

    /**
     * Obtiene la primera unidad de un mÃ³dulo.
     *
     * @param moduleCode CÃ³digo del mÃ³dulo
     * @return Primera unidad con sus lecciones
     */
    Optional<Unit> findFirstUnitByModuleCode(String moduleCode);

    /**
     * Obtiene todas las unidades de un mÃ³dulo.
     *
     * @param moduleCode CÃ³digo del mÃ³dulo
     * @return Lista de unidades
     */
    List<Unit> findUnitsByModuleCode(String moduleCode);

    /**
     * Obtiene una unidad por su ID, incluyendo sus lecciones.
     *
     * @param unitId ID de la unidad
     * @return Unidad con sus lecciones
     */
    Optional<Unit> findByIdWithLessons(Integer unitId);

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/UserLessonProgressRepositoryPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;



public interface UserLessonProgressRepositoryPort {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/UserProfileRepositoryPort.java
================================================================================
package com.bughuntersaga.api.application.port.out;

import com.bughuntersaga.api.domain.model.UserProfile;
import java.util.Optional;
import java.util.UUID;

public interface UserProfileRepositoryPort {
    UserProfile save(UserProfile userProfile);
    Optional<UserProfile> findById(UUID userId);
}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/UserRepositoryPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;



public interface UserRepositoryPort {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/UserStreakRepositoryPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;



public interface UserStreakRepositoryPort {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/port/out/UserXpHistoryRepositoryPort.java
================================================================================

package com.bughuntersaga.api.application.port.out;



public interface UserXpHistoryRepositoryPort {

    // Contenido de la interfaz

}


================================================================================
ğŸ“„ CONTENIDO DE: application/service/ClaimTreasureService.java
================================================================================

    package com.bughuntersaga.api.application.service;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.ClaimTreasureUseCase;


    @Service
@RequiredArgsConstructor
    public class ClaimTreasureService implements ClaimTreasureUseCase {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/service/CompleteLessonService.java
================================================================================

    package com.bughuntersaga.api.application.service;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.CompleteLessonUseCase;


    @Service
@RequiredArgsConstructor
    public class CompleteLessonService implements CompleteLessonUseCase {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/service/ForgotPasswordService.java
================================================================================

    package com.bughuntersaga.api.application.service;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.ForgotPasswordUseCase;


    @Service
@RequiredArgsConstructor
    public class ForgotPasswordService implements ForgotPasswordUseCase {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/service/GetLeaderboardService.java
================================================================================

    package com.bughuntersaga.api.application.service;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.GetLeaderboardUseCase;


    @Service
@RequiredArgsConstructor
    public class GetLeaderboardService implements GetLeaderboardUseCase {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/service/GetModuleProblemsService.java
================================================================================

package com.bughuntersaga.api.application.service;

import com.bughuntersaga.api.application.port.out.ProblemRepositoryPort;
import com.bughuntersaga.api.domain.model.Problem;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.GetModuleProblemsUseCase;

import java.util.ArrayList;
import java.util.List;


@Service
@RequiredArgsConstructor
public class GetModuleProblemsService implements GetModuleProblemsUseCase {

    private final ProblemRepositoryPort problemRepository;
    @Override
    public List<Problem> getModuleProblems(String moduleName) {
        List<Problem> problems = problemRepository.findProblemsByModuleCode(moduleName);
        return problems;
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: application/service/GetModuleUnitService.java
================================================================================

package com.bughuntersaga.api.application.service;

import com.bughuntersaga.api.application.port.out.UnitRepositoryPort;
import com.bughuntersaga.api.domain.model.Unit;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.GetModuleUnitUseCase;
import org.springframework.transaction.annotation.Transactional;


@Service
@RequiredArgsConstructor
@Transactional(readOnly = true)
public class GetModuleUnitService implements GetModuleUnitUseCase {

    private final UnitRepositoryPort unitRepository;


    @Override
    public Unit getModuleUnit(String moduleCode) {
        // FASE 1: Obtener la primera unidad
        Unit unit = unitRepository.findFirstUnitByModuleCode(moduleCode)
                .orElseThrow(() -> new RuntimeException("MÃ³dulo no encontrado: " + moduleCode));

        // FASE 1: Marcar todas las lecciones como ACTIVE
        if (unit.getLessons() != null) {
            unit.getLessons().forEach(lesson -> lesson.setStatus("ACTIVE"));
        }

        return unit;
    }

}


================================================================================
ğŸ“„ CONTENIDO DE: application/service/GetModulesService.java
================================================================================

package com.bughuntersaga.api.application.service;

import com.bughuntersaga.api.application.port.out.ModuleRepositoryPort;
import com.bughuntersaga.api.domain.model.Module;
import lombok.RequiredArgsConstructor;
import com.bughuntersaga.api.domain.model.Module;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.GetModulesUseCase;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;


@Service
@RequiredArgsConstructor
@Transactional(readOnly = true)
public class GetModulesService implements GetModulesUseCase {

    private final ModuleRepositoryPort moduleRepository;

    @Override
    public List<Module> getModules() {
        List<Module> modules = moduleRepository.findAll();
        return modules;
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: application/service/GetShopItemsService.java
================================================================================

    package com.bughuntersaga.api.application.service;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.GetShopItemsUseCase;


    @Service
@RequiredArgsConstructor
    public class GetShopItemsService implements GetShopItemsUseCase {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/service/GetUserProfileService.java
================================================================================

    package com.bughuntersaga.api.application.service;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.GetUserProfileUseCase;


    @Service
@RequiredArgsConstructor
    public class GetUserProfileService implements GetUserProfileUseCase {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/service/GetUserStatsService.java
================================================================================

    package com.bughuntersaga.api.application.service;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.GetUserStatsUseCase;


    @Service
@RequiredArgsConstructor
    public class GetUserStatsService implements GetUserStatsUseCase {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/service/LoginUserService.java
================================================================================

package com.bughuntersaga.api.application.service;

import lombok.RequiredArgsConstructor;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.domain.model.User;
import com.bughuntersaga.api.infrastructure.persistence.repository.UserRepository;
import com.bughuntersaga.api.infrastructure.security.jwt.JwtUtil;
import com.bughuntersaga.api.infrastructure.web.dto.UserLoginDTO;
import com.bughuntersaga.api.infrastructure.web.dto.AuthResponseDTO;
import com.bughuntersaga.api.infrastructure.web.dto.UserInfoDTO;

@Service
@RequiredArgsConstructor
public class LoginUserService {

    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;
    private final JwtUtil jwtUtil;

    public AuthResponseDTO login(UserLoginDTO request) {
        // Buscar usuario por username o email
        User user = userRepository.findByUsernameOrEmail(request.emailOrUsername(), request.emailOrUsername())
                .orElseThrow(() -> new IllegalArgumentException("User not found"));

        // Validar contraseÃ±a
        if (!passwordEncoder.matches(request.password(), user.getPasswordHash())) {
            throw new IllegalArgumentException("Invalid password");
        }

        // Generar token JWT
        String token = jwtUtil.generateToken(user.getUsername());

        // Devolver respuesta
        UserInfoDTO userInfo = new UserInfoDTO(
                user.getId().toString(),
                user.getUsername(),
                user.getName(),
                user.getEmail());

        return new AuthResponseDTO(token, userInfo);
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: application/service/PurchaseItemService.java
================================================================================

    package com.bughuntersaga.api.application.service;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.PurchaseItemUseCase;


    @Service
@RequiredArgsConstructor
    public class PurchaseItemService implements PurchaseItemUseCase {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/service/RegisterUserService.java
================================================================================
package com.bughuntersaga.api.application.service;

import com.bughuntersaga.api.application.dto.RegisterUserCommand;
import com.bughuntersaga.api.application.port.in.RegisterUserUseCase;
import com.bughuntersaga.api.application.port.out.UserProfileRepositoryPort;
import com.bughuntersaga.api.domain.exception.EmailAlreadyExistsException;
import com.bughuntersaga.api.domain.exception.UsernameAlreadyExistsException;
import com.bughuntersaga.api.domain.model.AuthToken;
import com.bughuntersaga.api.domain.model.User;
import com.bughuntersaga.api.domain.model.UserProfile;
import com.bughuntersaga.api.infrastructure.persistence.repository.UserRepository;
import com.bughuntersaga.api.infrastructure.security.jwt.JwtUtil;
import lombok.RequiredArgsConstructor;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
@RequiredArgsConstructor
public class RegisterUserService implements RegisterUserUseCase {

    private final UserRepository userRepository;
    private final UserProfileRepositoryPort userProfileRepositoryPort;
    private final PasswordEncoder passwordEncoder;
    private final JwtUtil jwtUtil;

    @Override
    @Transactional
    public AuthToken register(RegisterUserCommand command) {
        // Validar duplicados
        if (userRepository.findByUsername(command.getUsername()).isPresent()) {
            throw new UsernameAlreadyExistsException("El username ya existe: " + command.getUsername());
        }
        if (userRepository.findByEmail(command.getEmail()).isPresent()) {
            throw new EmailAlreadyExistsException("El email ya existe: " + command.getEmail());
        }

        // Hashear contraseÃ±a
        String passwordHash = passwordEncoder.encode(command.getRawPassword());

        // Crear usuario
        User newUser = User.builder()
                .username(command.getUsername())
                .email(command.getEmail())
                .passwordHash(passwordHash)
                .name(command.getName())
                .build();

        User savedUser = userRepository.save(newUser);

        // Crear perfil por defecto
        UserProfile newProfile = UserProfile.builder()
                .userId(savedUser.getId())
                .lingots(0)
                .dailyXpGoal(10)
                .soundEffectsEnabled(true)
                .build();

        userProfileRepositoryPort.save(newProfile);

        // Generar token JWT
        String token = jwtUtil.generateToken(savedUser.getUsername());

        // Retornar token + usuario
        return AuthToken.builder()
                .token(token)
                .user(savedUser)
                .build();
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: application/service/UpdateUserAccountService.java
================================================================================

    package com.bughuntersaga.api.application.service;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.UpdateUserAccountUseCase;


    @Service
@RequiredArgsConstructor
    public class UpdateUserAccountService implements UpdateUserAccountUseCase {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: application/service/UpdateUserSettingsService.java
================================================================================

    package com.bughuntersaga.api.application.service;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import com.bughuntersaga.api.application.port.in.UpdateUserSettingsUseCase;


    @Service
@RequiredArgsConstructor
    public class UpdateUserSettingsService implements UpdateUserSettingsUseCase {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: domain/exception/EmailAlreadyExistsException.java
================================================================================

package com.bughuntersaga.api.domain.exception;

import java.lang.RuntimeException;



public class EmailAlreadyExistsException extends RuntimeException {

public EmailAlreadyExistsException(String message) {
    super(message);
}

}


================================================================================
ğŸ“„ CONTENIDO DE: domain/exception/InsufficientFundsException.java
================================================================================

package com.bughuntersaga.api.domain.exception;

import java.lang.RuntimeException;



public class InsufficientFundsException extends RuntimeException {

public InsufficientFundsException(String message) {
    super(message);
}

}


================================================================================
ğŸ“„ CONTENIDO DE: domain/exception/InvalidCredentialsException.java
================================================================================

package com.bughuntersaga.api.domain.exception;

import java.lang.RuntimeException;



public class InvalidCredentialsException extends RuntimeException {

public InvalidCredentialsException(String message) {
    super(message);
}

}


================================================================================
ğŸ“„ CONTENIDO DE: domain/exception/LessonAlreadyCompletedException.java
================================================================================

package com.bughuntersaga.api.domain.exception;

import java.lang.RuntimeException;



public class LessonAlreadyCompletedException extends RuntimeException {
    public LessonAlreadyCompletedException(String message) {
        super(message);
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: domain/exception/LessonNotFoundException.java
================================================================================
package com.bughuntersaga.api.domain.exception;

public class LessonNotFoundException extends RuntimeException {
    public LessonNotFoundException(Integer lessonId) {
        super("Lesson not found with id: " + lessonId);
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: domain/exception/ModuleNotFoundException.java
================================================================================

package com.bughuntersaga.api.domain.exception;

import java.lang.RuntimeException;



public class ModuleNotFoundException extends RuntimeException {

public ModuleNotFoundException(String message) {
    super(message);
}

}


================================================================================
ğŸ“„ CONTENIDO DE: domain/exception/ResourceNotFoundException.java
================================================================================

package com.bughuntersaga.api.domain.exception;

import java.lang.RuntimeException;



public class ResourceNotFoundException extends RuntimeException {
    public ResourceNotFoundException(String message) {
        super(message);
    }

    public ResourceNotFoundException(String resourceType, Object id) {
        super(String.format("%s con ID '%s' no encontrado", resourceType, id));
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: domain/exception/TreasureAlreadyClaimedException.java
================================================================================

package com.bughuntersaga.api.domain.exception;

import java.lang.RuntimeException;



public class TreasureAlreadyClaimedException extends RuntimeException {

public TreasureAlreadyClaimedException(String message) {
    super(message);
}

}


================================================================================
ğŸ“„ CONTENIDO DE: domain/exception/UserNotFoundException.java
================================================================================

package com.bughuntersaga.api.domain.exception;

import java.lang.RuntimeException;



public class UserNotFoundException extends RuntimeException {

public UserNotFoundException(String message) {
    super(message);
}

}


================================================================================
ğŸ“„ CONTENIDO DE: domain/exception/UsernameAlreadyExistsException.java
================================================================================

package com.bughuntersaga.api.domain.exception;

import java.lang.RuntimeException;



public class UsernameAlreadyExistsException extends RuntimeException {

public UsernameAlreadyExistsException(String message) {
    super(message);
}

}


================================================================================
ğŸ“„ CONTENIDO DE: domain/model/AuthToken.java
================================================================================
package com.bughuntersaga.api.domain.model;

import lombok.Builder;
import lombok.Getter;
import lombok.Setter;

@Getter
@Setter
@Builder
public class AuthToken {
    private String token;
    private User user;
}


================================================================================
ğŸ“„ CONTENIDO DE: domain/model/Leaderboard.java
================================================================================

    package com.bughuntersaga.api.domain.model;

    import lombok.Getter;
import lombok.Setter;
import lombok.Builder;
import lombok.NoArgsConstructor;


    @Getter
@Setter
@Builder
@NoArgsConstructor
    public class Leaderboard {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: domain/model/LeaderboardEntry.java
================================================================================

    package com.bughuntersaga.api.domain.model;

    import lombok.Getter;
import lombok.Setter;
import lombok.Builder;
import lombok.NoArgsConstructor;


    @Getter
@Setter
@Builder
@NoArgsConstructor
    public class LeaderboardEntry {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: domain/model/Lesson.java
================================================================================
package com.bughuntersaga.api.domain.model;

import lombok.*;

@Getter
@Setter
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class Lesson {
    private Integer id;
    private Integer unitId;
    private String type;          // "star", "book", "trophy", "treasure", "fast-forward"
    private String description;
    private Integer position;

    /**
     * Estado de la lecciÃ³n para el usuario actual.
     * Por ahora siempre serÃ¡ "ACTIVE" (Fase 1).
     * En Fase 4 se calcularÃ¡ segÃºn el progreso.
     */
    private String status;        // "LOCKED", "ACTIVE", "COMPLETE"
}


================================================================================
ğŸ“„ CONTENIDO DE: domain/model/Module.java
================================================================================

package com.bughuntersaga.api.domain.model;

import lombok.*;

import java.util.Map;


/**
 * Entidad de dominio Module.
 * POJO puro sin dependencias de frameworks.
 */
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class Module {
    private Integer id;
    private String code;
    private String name;
    private String description;
    private Map<String, Object> uiConfig;
}

================================================================================
ğŸ“„ CONTENIDO DE: domain/model/Problem.java
================================================================================

package com.bughuntersaga.api.domain.model;

import lombok.*;

import java.util.List;


/**
 * Entidad de dominio Problem.
 * Contiene campos especÃ­ficos segÃºn el tipo de problema.
 */
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class Problem {

    private String type;

    // Campos para tipo INFO
    private String moduleTitle;
    private String introduction;
    private List<String> objectives;

    // Campos para preguntas
    private String question;

    // Campos para SELECT_1_OF_3
    private List<AnswerOption> answers;
    private Integer correctAnswer;

    // Campos para FILL_IN_THE_BLANK
    private List<String> answerTiles;
    private List<Integer> correctAnswerIndices;

    /**
     * OpciÃ³n de respuesta.
     */
    @Getter
    @Setter
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor
    public static class AnswerOption {
        private String name;
    }
}

================================================================================
ğŸ“„ CONTENIDO DE: domain/model/ShopItem.java
================================================================================

    package com.bughuntersaga.api.domain.model;

    import lombok.Getter;
import lombok.Setter;
import lombok.Builder;
import lombok.NoArgsConstructor;


    @Getter
@Setter
@Builder
@NoArgsConstructor
    public class ShopItem {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: domain/model/Unit.java
================================================================================

package com.bughuntersaga.api.domain.model;

import lombok.*;

import java.util.List;


@Getter
@Setter
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class Unit {
    private Integer id;
    private Integer unitNumber;
    private String description;
    /**
     * Lecciones que componen esta unidad.
     * Se carga bajo demanda segÃºn la necesidad.
     */
    private List<Lesson> lessons;
}


================================================================================
ğŸ“„ CONTENIDO DE: domain/model/User.java
================================================================================
package com.bughuntersaga.api.domain.model;

import jakarta.persistence.*;
import lombok.*;
import java.time.LocalDateTime;
import java.util.UUID;

@Entity
@Table(name = "users", uniqueConstraints = {
        @UniqueConstraint(columnNames = "username"),
        @UniqueConstraint(columnNames = "email")
})
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private UUID id;

    @Column(nullable = false, unique = true)
    private String username;

    @Column(nullable = false, unique = true)
    private String email;

    @Column(nullable = false, name = "password_hash")
    private String passwordHash;

    @Column(nullable = false)
    private String name;

    @Column(nullable = true)
    private String lastname;

    @Column(nullable = false, updatable = false, name = "created_at")
    private LocalDateTime createdAt;

    @Column(nullable = false, name = "updated_at")
    private LocalDateTime updatedAt;

    @PrePersist
    protected void onCreate() {
        createdAt = LocalDateTime.now();
        updatedAt = LocalDateTime.now();
    }

    @PreUpdate
    protected void onUpdate() {
        updatedAt = LocalDateTime.now();
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: domain/model/UserLessonProgress.java
================================================================================

    package com.bughuntersaga.api.domain.model;

    import lombok.Getter;
import lombok.Setter;
import lombok.Builder;
import lombok.NoArgsConstructor;


    @Getter
@Setter
@Builder
@NoArgsConstructor
    public class UserLessonProgress {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: domain/model/UserProfile.java
================================================================================

package com.bughuntersaga.api.domain.model;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

import java.util.UUID;

/**
 * Entidad de dominio UserProfile.
 *
 * Representa el perfil de un usuario con su informaciÃ³n de progreso.
 */
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class UserProfile {
    private UUID userId;
    private Integer lingots;
    private Integer dailyXpGoal;
    private Boolean soundEffectsEnabled;
}

================================================================================
ğŸ“„ CONTENIDO DE: domain/model/UserStreak.java
================================================================================

package com.bughuntersaga.api.domain.model;

import lombok.*;
import java.time.LocalDate;
import java.util.UUID;

/**
 * Entidad de dominio UserStreak.
 *
 * Representa la racha de dÃ­as consecutivos de un usuario.
 */
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class UserStreak {
    private UUID userId;
    private LocalDate activityDate;
}

================================================================================
ğŸ“„ CONTENIDO DE: domain/model/UserXpHistory.java
================================================================================

    package com.bughuntersaga.api.domain.model;

    import lombok.Getter;
import lombok.Setter;
import lombok.Builder;
import lombok.NoArgsConstructor;


    @Getter
@Setter
@Builder
@NoArgsConstructor
    public class UserXpHistory {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/config/BeanConfiguration.java
================================================================================

package com.bughuntersaga.api.infrastructure.config;

import org.springframework.context.annotation.Configuration;


@Configuration
public class BeanConfiguration {
    // La mayorÃ­a de los beans se inyectarÃ¡n automÃ¡ticamente
    // con @Service, @Repository, @Component y @RequiredArgsConstructor.
    // Puedes usar esta clase para beans personalizados.

}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/config/OpenAPIConfig.java
================================================================================
package com.bughuntersaga.api.infrastructure.config;

import io.swagger.v3.oas.models.OpenAPI;
import io.swagger.v3.oas.models.info.Info;
import io.swagger.v3.oas.models.info.Contact;
import io.swagger.v3.oas.models.servers.Server;
import io.swagger.v3.oas.models.security.SecurityScheme;
import io.swagger.v3.oas.models.security.SecurityRequirement;
import io.swagger.v3.oas.models.Components;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.List;

@Configuration
public class OpenAPIConfig {

    @Bean
    public OpenAPI bugHunterOpenAPI() {
        return new OpenAPI()
                .info(new Info()
                        .title("BugHunter Saga API")
                        .description("""
                            API (Contrato Primero) para la plataforma gamificada BugHunter Saga.
                            DiseÃ±ada para soportar la implementaciÃ³n del frontend en Next.js
                            y el backend en Spring Boot para el proyecto de tesis de Max CarriÃ³n.
                            """)
                        .version("1.0.0")
                        .contact(new Contact()
                                .name("Max CarriÃ³n")
                                .email("max.carrion@epn.edu.ec")))
                .servers(List.of(
                        new Server()
                                .url("http://localhost:8080")
                                .description("Servidor de desarrollo"),
                        new Server()
                                .url("/api")
                                .description("Prefijo base de la API")))
                .components(new Components()
                        .addSecuritySchemes("bearerAuth", new SecurityScheme()
                                .type(SecurityScheme.Type.HTTP)
                                .scheme("bearer")
                                .bearerFormat("JWT")
                                .description("Ingresa tu token JWT aquÃ­")))
                .addSecurityItem(new SecurityRequirement().addList("bearerAuth"));
    }
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/adapter/LeaderboardRepositoryAdapter.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.adapter;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import com.bughuntersaga.api.application.port.out.LeaderboardRepositoryPort;


    @Repository
@RequiredArgsConstructor
    public class LeaderboardRepositoryAdapter implements LeaderboardRepositoryPort {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/adapter/LessonRepositoryAdapter.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.adapter;

    import com.bughuntersaga.api.domain.model.Lesson;
    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import com.bughuntersaga.api.application.port.out.LessonRepositoryPort;

    import java.util.List;
    import java.util.Optional;


    @Repository
@RequiredArgsConstructor
    public class LessonRepositoryAdapter implements LessonRepositoryPort {

    // Contenido de la clase

        @Override
        public Optional<Lesson> findById(Integer id) {
            return Optional.empty();
        }

        @Override
        public List<Lesson> findByUnitId(Integer unitId) {
            return List.of();
        }
    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/adapter/ModuleRepositoryAdapter.java
================================================================================

package com.bughuntersaga.api.infrastructure.persistence.adapter;

import com.bughuntersaga.api.domain.model.Module;
import com.bughuntersaga.api.infrastructure.persistence.mapper.ContentPersistenceMapper;
import com.bughuntersaga.api.infrastructure.persistence.repository.ModuleJpaRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import com.bughuntersaga.api.application.port.out.ModuleRepositoryPort;

import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;


@Repository
@RequiredArgsConstructor
public class ModuleRepositoryAdapter implements ModuleRepositoryPort {

    private final ModuleJpaRepository moduleJpaRepository;
    private final ContentPersistenceMapper contentMapper;

    @Override
    public List<Module> findAll() {
        return moduleJpaRepository.findAll().stream().map(contentMapper::moduleToDomain)
                .collect(Collectors.toList());
    }

    @Override
    public Optional<Module> findById(Integer id) {
        return moduleJpaRepository.findById(id).map(contentMapper::moduleToDomain);
    }

    @Override
    public Optional<Module> findByCode(String code) {
        return moduleJpaRepository.findByCode(code).map(contentMapper::moduleToDomain);
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/adapter/ProblemRepositoryAdapter.java
================================================================================

package com.bughuntersaga.api.infrastructure.persistence.adapter;

import com.bughuntersaga.api.application.port.out.ProblemRepositoryPort;
import com.bughuntersaga.api.domain.model.Problem;
import com.bughuntersaga.api.infrastructure.persistence.mapper.ContentPersistenceMapper;
import com.bughuntersaga.api.infrastructure.persistence.repository.ProblemJpaRepository;
import com.bughuntersaga.api.infrastructure.web.mapper.ContentApiMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

/**
 * Adaptador de persistencia para problemas.
 */
@Component
@RequiredArgsConstructor
@Slf4j
public class ProblemRepositoryAdapter implements ProblemRepositoryPort {

    private final ProblemJpaRepository jpaRepository;
    private final ContentPersistenceMapper mapper;

    @Override
    public List<Problem> findProblemsByModuleCode(String moduleCode) {
        return jpaRepository.findProblemsByModuleCode(moduleCode).stream()
                .map(mapper::problemToDomain)
                .collect(Collectors.toList());
    }

    @Override
    public Optional<Problem> findById(Integer id) {
        return jpaRepository.findById(id).map(mapper::problemToDomain);
    }

    @Override
    public List<Problem> findByLessonId(Integer lessonId) {
        return jpaRepository.findByLessonIdOrderByPositionAsc(lessonId).stream()
                .map(mapper::problemToDomain)
                .collect(Collectors.toList());
    }
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/adapter/ShopItemRepositoryAdapter.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.adapter;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import com.bughuntersaga.api.application.port.out.ShopItemRepositoryPort;


    @Repository
@RequiredArgsConstructor
    public class ShopItemRepositoryAdapter implements ShopItemRepositoryPort {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/adapter/TransactionAdapter.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.adapter;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import com.bughuntersaga.api.application.port.out.TransactionPort;


    @Repository
@RequiredArgsConstructor
    public class TransactionAdapter implements TransactionPort {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/adapter/UnitRepositoryAdapter.java
================================================================================

package com.bughuntersaga.api.infrastructure.persistence.adapter;

import com.bughuntersaga.api.application.port.out.UnitRepositoryPort;
import com.bughuntersaga.api.domain.model.Lesson;
import com.bughuntersaga.api.domain.model.Unit;
import com.bughuntersaga.api.infrastructure.persistence.entity.LessonEntity;
import com.bughuntersaga.api.infrastructure.persistence.entity.UnitEntity;
import com.bughuntersaga.api.infrastructure.persistence.mapper.ContentPersistenceMapper;
import com.bughuntersaga.api.infrastructure.persistence.repository.LessonJpaRepository;
import com.bughuntersaga.api.infrastructure.persistence.repository.UnitJpaRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

/**
 * Adaptador de persistencia para unidades.
 */
@Component
@RequiredArgsConstructor
@Slf4j
public class UnitRepositoryAdapter implements UnitRepositoryPort {

    private final UnitJpaRepository unitJpaRepository;
    private final LessonJpaRepository lessonJpaRepository;
    private final ContentPersistenceMapper mapper;

    @Override
    public Optional<Unit> findFirstUnitByModuleCode(String moduleCode) {
        return unitJpaRepository.findByModuleCodeOrderByUnitNumber(moduleCode).stream()
                .findFirst()
                .map(this::mapUnitWithLessons);
    }

    @Override
    public List<Unit> findUnitsByModuleCode(String moduleCode) {

        return unitJpaRepository.findByModuleCode(moduleCode).stream()
                .map(this::mapUnitWithLessons)
                .collect(Collectors.toList());
    }

    @Override
    public Optional<Unit> findByIdWithLessons(Integer unitId) {

        return unitJpaRepository.findById(unitId)
                .map(this::mapUnitWithLessons);
    }

    /**
     * Mapea UnitEntity a Unit y carga sus lecciones.
     */
    private Unit mapUnitWithLessons(UnitEntity unitEntity) {
        // Mapear unidad
        Unit unit = mapper.unitToDomain(unitEntity);

        // Cargar lecciones
        List<LessonEntity> lessonEntities = lessonJpaRepository
                .findByUnitIdOrderByPositionAsc(unitEntity.getId());

        List<Lesson> lessons = lessonEntities.stream()
                .map(mapper::lessonToDomain)
                .collect(Collectors.toList());

        unit.setLessons(lessons);

        return unit;
    }
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/adapter/UserLessonProgressRepositoryAdapter.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.adapter;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import com.bughuntersaga.api.application.port.out.UserLessonProgressRepositoryPort;


    @Repository
@RequiredArgsConstructor
    public class UserLessonProgressRepositoryAdapter implements UserLessonProgressRepositoryPort {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/adapter/UserProfileRepositoryAdapter.java
================================================================================
package com.bughuntersaga.api.infrastructure.persistence.adapter;

import com.bughuntersaga.api.application.port.out.UserProfileRepositoryPort;
import com.bughuntersaga.api.domain.model.UserProfile;
import com.bughuntersaga.api.infrastructure.persistence.entity.UserProfileEntity;
import com.bughuntersaga.api.infrastructure.persistence.mapper.UserPersistenceMapper;
import com.bughuntersaga.api.infrastructure.persistence.repository.UserProfileJpaRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;

import java.util.Optional;
import java.util.UUID;

@Repository
@RequiredArgsConstructor
public class UserProfileRepositoryAdapter implements UserProfileRepositoryPort {

    private final UserProfileJpaRepository userProfileJpaRepository;
    private final UserPersistenceMapper userPersistenceMapper;

    @Override
    public UserProfile save(UserProfile userProfile) {
        UserProfileEntity entity = userPersistenceMapper.toUserProfileEntity(userProfile);
        UserProfileEntity savedEntity = userProfileJpaRepository.save(entity);
        return userPersistenceMapper.toUserProfileDomain(savedEntity);
    }

    @Override
    public Optional<UserProfile> findById(UUID userId) {
        return userProfileJpaRepository.findById(userId)
                .map(userPersistenceMapper::toUserProfileDomain);
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/adapter/UserRepositoryAdapter.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.adapter;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import com.bughuntersaga.api.application.port.out.UserRepositoryPort;


    @Repository
@RequiredArgsConstructor
    public class UserRepositoryAdapter implements UserRepositoryPort {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/adapter/UserStreakRepositoryAdapter.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.adapter;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import com.bughuntersaga.api.application.port.out.UserStreakRepositoryPort;


    @Repository
@RequiredArgsConstructor
    public class UserStreakRepositoryAdapter implements UserStreakRepositoryPort {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/adapter/UserXpHistoryRepositoryAdapter.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.adapter;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import com.bughuntersaga.api.application.port.out.UserXpHistoryRepositoryPort;


    @Repository
@RequiredArgsConstructor
    public class UserXpHistoryRepositoryAdapter implements UserXpHistoryRepositoryPort {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/LeagueEntity.java
================================================================================
package com.bughuntersaga.api.infrastructure.persistence.entity;

import jakarta.persistence.*;
import lombok.*;

@Entity
@Table(name = "leagues")
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class LeagueEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id")
    private Integer id;

    @Column(name = "name", nullable = false, length = 50, unique = true)
    private String name;

    @Column(name = "min_xp", nullable = false)
    private Integer minXp;

    @Column(name = "max_xp")
    private Integer maxXp;

    @Column(name = "icon", length = 50)
    private String icon;
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/LessonEntity.java
================================================================================
package com.bughuntersaga.api.infrastructure.persistence.entity;

import jakarta.persistence.*;
import lombok.*;
/**
 * Entidad JPA para la tabla 'lessons'.
 */
@Entity
@Table(name = "lessons")
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class LessonEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    @Column(name = "unit_id", nullable = false)
    private Integer unitId;

    @Column(nullable = false, length = 50)
    private String type;

    @Column(columnDefinition = "TEXT")
    private String description;

    @Column(nullable = false)
    private Integer position;
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/ModuleEntity.java
================================================================================

package com.bughuntersaga.api.infrastructure.persistence.entity;

import jakarta.persistence.*;
import lombok.*;
import org.hibernate.annotations.JdbcTypeCode;
import org.hibernate.type.SqlTypes;

import java.util.Map;

/**
 * Entidad JPA para la tabla 'modules'.
 *
 * Representa un mÃ³dulo de aprendizaje (ej. MÃ³dulo A - Equivalencia).
 */
@Entity
@Table(name = "modules")
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class ModuleEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id")
    private Integer id;

    @Column(name = "code", unique = true, nullable = false, length = 20)
    private String code;

    @Column(name = "name", nullable = false, length = 100)
    private String name;

    @Column(name = "description", columnDefinition = "TEXT")
    private String description;

    /**
     * ConfiguraciÃ³n de UI en formato JSON.
     * Ejemplo: {"backgroundColor": "bg-blue-500", "icon": "ğŸ¯"}
     */
    @JdbcTypeCode(SqlTypes.JSON)
    @Column(name = "ui_config", columnDefinition = "jsonb")
    private Map<String, Object> uiConfig;
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/ProblemEntity.java
================================================================================

package com.bughuntersaga.api.infrastructure.persistence.entity;

import jakarta.persistence.*;
import lombok.*;
import org.hibernate.annotations.JdbcTypeCode;
import org.hibernate.type.SqlTypes;

import java.util.Map;

/**
 * Entidad JPA para la tabla 'problems'.
 */
@Entity
@Table(name = "problems")
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class ProblemEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    @Column(name = "lesson_id", nullable = false)
    private Integer lessonId;

    @Column(nullable = false, length = 50)
    private String type;

    @JdbcTypeCode(SqlTypes.JSON)
    @Column(nullable = false, columnDefinition = "jsonb")
    private Map<String, Object> content;

    @Column(nullable = false)
    private Integer position;
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/ShopItemEntity.java
================================================================================
package com.bughuntersaga.api.infrastructure.persistence.entity;

import jakarta.persistence.*;
import lombok.*;

@Entity
@Table(name = "shop_items")
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ShopItemEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id")
    private Integer id;

    @Column(name = "item_code", nullable = false, unique = true, length = 50)
    private String itemCode;

    @Column(name = "name", nullable = false, length = 100)
    private String name;

    @Column(name = "description", columnDefinition = "TEXT")
    private String description;

    @Column(name = "cost", nullable = false)
    private Integer cost;

    @Column(name = "icon", length = 50)
    private String icon;
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/UnitEntity.java
================================================================================

package com.bughuntersaga.api.infrastructure.persistence.entity;

import jakarta.persistence.*;
import lombok.*;

/**
 * Entidad JPA para la tabla 'units'.
 *
 * Representa una unidad dentro de un mÃ³dulo.
 */
@Entity
@Table(name = "units")
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class UnitEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id")
    private Integer id;

    @Column(name = "module_id", nullable = false)
    private Integer moduleId;

    @Column(name = "unit_number", nullable = false)
    private Integer unitNumber;

    @Column(name = "description", columnDefinition = "TEXT")
    private String description;
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/UserEntity.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.entity;

    import jakarta.persistence.*;
import lombok.*;
import java.util.UUID;
import java.time.ZonedDateTime;


    @Entity
@Table(name = "users")
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
    public class UserEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private UUID id;

    @Column(unique = true, nullable = false, length = 50)
    private String lastname;

    @Column(length = 100)
    private String name;

    @Column(unique = true, nullable = false)
    private String email;

    @Column(name = "password_hash", nullable = false)
    private String passwordHash;

    @Column(name = "created_at", updatable = false, columnDefinition = "timestamptz DEFAULT (now())")
    private ZonedDateTime createdAt;

    @OneToOne(mappedBy = "user", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    private UserProfileEntity userProfile;

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/UserLessonProgressEntity.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.entity;

    import jakarta.persistence.*;
import lombok.*;
import java.time.ZonedDateTime;


    @Entity
@Table(name = "user_lesson_progress")
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
    public class UserLessonProgressEntity {

    @EmbeddedId
    private UserLessonProgressId id;

    @ManyToOne(fetch = FetchType.LAZY)
    @MapsId("userId")
    @JoinColumn(name = "user_id")
    private UserEntity user;

    @ManyToOne(fetch = FetchType.LAZY)
    @MapsId("lessonId")
    @JoinColumn(name = "lesson_id")
    private LessonEntity lesson;

    @Column(name = "completed_at", columnDefinition = "timestamptz DEFAULT (now())")
    private ZonedDateTime completedAt;

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/UserLessonProgressId.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.entity;

    import jakarta.persistence.Embeddable;
import lombok.*;
import java.io.Serializable;
import java.util.UUID;


    @Embeddable
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@EqualsAndHashCode
    public class UserLessonProgressId implements Serializable {

    private UUID userId;
    private Integer lessonId;

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/UserProfileEntity.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.entity;

    import jakarta.persistence.*;
import lombok.*;
import java.util.UUID;


    @Entity
@Table(name = "user_profiles")
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
    public class UserProfileEntity {

    @Id
    @Column(name = "user_id")
    private UUID userId;

    @OneToOne(fetch = FetchType.LAZY)
    @MapsId
    @JoinColumn(name = "user_id")
    private UserEntity user;

    @Column(nullable = false)
    private Integer lingots;

    @Column(name = "daily_xp_goal", nullable = false)
    private Integer dailyXpGoal;

    @Column(name = "sound_effects_enabled", nullable = false)
    private Boolean soundEffectsEnabled;

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/UserStreakEntity.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.entity;

    import jakarta.persistence.*;
import lombok.*;


    @Entity
@Table(name = "user_streaks")
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
    public class UserStreakEntity {

    @EmbeddedId
    private UserStreakId id;

    @ManyToOne(fetch = FetchType.LAZY)
    @MapsId("userId")
    @JoinColumn(name = "user_id")
    private UserEntity user;

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/UserStreakId.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.entity;

import jakarta.persistence.Embeddable;
import lombok.*;
import java.io.Serializable;
import java.util.UUID;
import java.time.LocalDate;


    @Embeddable
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@EqualsAndHashCode
    public class UserStreakId implements Serializable {

    private UUID userId;
    private LocalDate activityDate;

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/entity/UserXpHistoryEntity.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.entity;

    import jakarta.persistence.*;
import lombok.*;
import java.util.UUID;
import java.time.ZonedDateTime;


    @Entity
@Table(name = "user_xp_history")
@Getter
@Setter
@Builder
@NoArgsConstructor
@AllArgsConstructor
    public class UserXpHistoryEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id", nullable = false)
    private UserEntity user;

    @Column(name = "xp_earned", nullable = false)
    private Integer xpEarned;

    @Column(name = "source_type", length = 50)
    private String sourceType;

    @Column(name = "source_id")
    private Integer sourceId;

    @Column(name = "created_at", columnDefinition = "timestamptz DEFAULT (now())")
    private ZonedDateTime createdAt;

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/mapper/ContentPersistenceMapper.java
================================================================================

package com.bughuntersaga.api.infrastructure.persistence.mapper;
import com.bughuntersaga.api.domain.model.Lesson;
import com.bughuntersaga.api.domain.model.Module;
import com.bughuntersaga.api.domain.model.Problem;
import com.bughuntersaga.api.domain.model.Unit;
import com.bughuntersaga.api.infrastructure.persistence.entity.LessonEntity;
import com.bughuntersaga.api.infrastructure.persistence.entity.ModuleEntity;
import com.bughuntersaga.api.infrastructure.persistence.entity.ProblemEntity;
import com.bughuntersaga.api.infrastructure.persistence.entity.UnitEntity;
import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.ReportingPolicy;

import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

/**
 * Mapper consolidado para entidades de persistencia de Content.
 *
 * Usa nombres ESPECÃFICOS para evitar ambigÃ¼edad:
 * - moduleToDomain() / moduleToEntity() â† Para Module
 * - problemToDomain() / problemToEntity() â† Para Problem
 *
 * ConfiguraciÃ³n:
 * - componentModel = "spring": Genera bean de Spring
 * - unmappedTargetPolicy = IGNORE: Ignora campos sin mapear
 */
@Mapper(
        componentModel = "spring",
        unmappedTargetPolicy = ReportingPolicy.IGNORE
)
public interface ContentPersistenceMapper {

    // ========================================
    // Mapeo de Module (AutomÃ¡tico)
    // ========================================

    /**
     * Convierte ModuleEntity â†’ Module.
     * MapStruct genera el cÃ³digo automÃ¡ticamente.
     */
    Module moduleToDomain(ModuleEntity moduleEntity);

    /**
     * Convierte Module â†’ ModuleEntity.
     * MapStruct genera el cÃ³digo automÃ¡ticamente.
     */
    ModuleEntity moduleToEntity(Module module);


    // ========================================
    // Mapeo de Unit
    // ========================================

    /**
     * Convierte UnitEntity â†’ Unit.
     *
     * NOTA: El campo 'lessons' no se mapea automÃ¡ticamente.
     * Se debe cargar y asignar manualmente en el adaptador.
     */
    @Mapping(target = "lessons", ignore = true)
    Unit unitToDomain(UnitEntity entity);

    UnitEntity unitToEntity(Unit domain);

    // ========================================
    // Mapeo de Lesson
    // ========================================

    /**
     * Convierte LessonEntity â†’ Lesson.
     *
     * NOTA: El campo 'status' no existe en la BD.
     * Se debe asignar manualmente segÃºn la lÃ³gica de negocio.
     */
    @Mapping(target = "status", ignore = true)
    Lesson lessonToDomain(LessonEntity entity);

    LessonEntity lessonToEntity(Lesson domain);


    // ========================================
    // Mapeo de Problem (Corregido)
    // ========================================

    default Problem problemToDomain(ProblemEntity entity) {
        if (entity == null) return null;

        Problem.ProblemBuilder builder = Problem.builder()
                .type(entity.getType());

        Map<String, Object> content = entity.getContent();
        if (content == null) return builder.build();

        // Extraer campos comunes primero (como 'question')
        builder.question((String) content.get("question"));

        // Extraer campos especÃ­ficos del tipo
        switch (entity.getType()) {
            case "INFO" -> mapInfoType(builder, content);
            case "SELECT_1_OF_3" -> mapSelectType(builder, content);
            case "FILL_IN_THE_BLANK" -> mapFillInBlankType(builder, content);
        }

        return builder.build();
    }

    // ... (problemToEntity estÃ¡ bien) ...

    // ========================================
    // MÃ©todos Auxiliares (Corregidos)
    // ========================================

    /**
     * Mapea campos para tipo INFO.
     * CORREGIDO: Extrae: title, content
     */
    @SuppressWarnings("unchecked")
    default void mapInfoType(Problem.ProblemBuilder builder, Map<String, Object> content) {
        // Tu SQL usa 'title', no 'moduleTitle' en el problema
        builder.introduction((String) content.get("title"));

        // AquÃ­ puedes decidir cÃ³mo mapear 'content' y 'example'
        // Por ejemplo, podrÃ­as concatenarlos o usar 'introduction' para 'content'
        // Asumamos que 'introduction' en el dominio es el 'title' de la BD
        // y 'moduleTitle' es el 'content' de la BD.
        builder.moduleTitle((String) content.get("content"));

        // 'objectives' no existe en tu SQL.
    }

    /**
     * Mapea campos para tipo SELECT_1_OF_3.
     * CORREGIDO: Extrae: question, options (como answers), correctAnswer
     */
    @SuppressWarnings("unchecked")
    default void mapSelectType(Problem.ProblemBuilder builder, Map<String, Object> content) {
        // 'question' ya se mapea arriba

        // CORREGIDO: Tu SQL usa "options", no "answers"
        Object answersObj = content.get("options");
        if (answersObj instanceof List) {
            List<Map<String, Object>> answersRaw = (List<Map<String, Object>>) answersObj;
            List<Problem.AnswerOption> answers = answersRaw.stream()
                    .map(map -> Problem.AnswerOption.builder()
                            // CORREGIDO: Tu SQL usa "text", no "name"
                            .name((String) map.get("text"))
                            .build())
                    .collect(Collectors.toList());
            builder.answers(answers);
        }

        // Mapear respuesta correcta
        // Tu SQL la tiene como String ("b"), pero tu dominio la espera como Integer.
        // AquÃ­ necesitarÃ¡s una lÃ³gica para convertir "a"->0, "b"->1, "c"->2
        Object correctAnswer = content.get("correctAnswer");
        if (correctAnswer instanceof String) {
            switch ((String) correctAnswer) {
                case "a" -> builder.correctAnswer(0);
                case "b" -> builder.correctAnswer(1);
                case "c" -> builder.correctAnswer(2);
                // AÃ±ade mÃ¡s casos si es necesario
            }
        }
    }

    /**
     * Mapea campos para tipo FILL_IN_THE_BLANK.
     * CORREGIDO: Extrae: question, blanks, correctAnswers
     */
    @SuppressWarnings("unchecked")
    default void mapFillInBlankType(Problem.ProblemBuilder builder, Map<String, Object> content) {
        // 'question' ya se mapea arriba

        // CORREGIDO: Tu SQL usa "blanks", no "answerTiles"
        Object answerTiles = content.get("blanks");
        if (answerTiles instanceof List) {
            builder.answerTiles((List<String>) answerTiles);
        }

        // CORREGIDO: Tu SQL usa "correctAnswers" (lista de Strings)
        // pero tu dominio espera "correctAnswerIndices" (lista de Integers)
        // Por ahora, asumirÃ© que "correctAnswers" de tu SQL *deberÃ­a*
        // haber sido "correctAnswerIndices" con nÃºmeros.
        // Si no, la lÃ³gica de conversiÃ³n es mÃ¡s compleja.
        Object correctIndices = content.get("correctAnswerIndices"); // Asumiendo que cambias el SQL
        if (correctIndices instanceof List) {
            List<Integer> indices = ((List<?>) correctIndices).stream()
                    .filter(obj -> obj instanceof Number)
                    .map(obj -> ((Number) obj).intValue())
                    .collect(Collectors.toList());
            builder.correctAnswerIndices(indices);
        }
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/mapper/GamificationPersistenceMapper.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.mapper;

    import org.mapstruct.Mapper;
import org.mapstruct.ReportingPolicy;


    @Mapper(componentModel = "spring", unmappedTargetPolicy = ReportingPolicy.IGNORE)
public interface GamificationPersistenceMapper {

        // Contenido de la interfaz

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/mapper/ProgressPersistenceMapper.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.mapper;

    import org.mapstruct.Mapper;
import org.mapstruct.ReportingPolicy;


@Mapper(componentModel = "spring", unmappedTargetPolicy = ReportingPolicy.IGNORE)
public interface ProgressPersistenceMapper {


    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/mapper/UserPersistenceMapper.java
================================================================================
package com.bughuntersaga.api.infrastructure.persistence.mapper;

import com.bughuntersaga.api.domain.model.User;
import com.bughuntersaga.api.domain.model.UserProfile;
import com.bughuntersaga.api.infrastructure.persistence.entity.UserEntity;
import com.bughuntersaga.api.infrastructure.persistence.entity.UserProfileEntity;
import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.ReportingPolicy;

@Mapper(componentModel = "spring", unmappedTargetPolicy = ReportingPolicy.IGNORE)
public interface UserPersistenceMapper {

    UserEntity toUserEntity(User user);
    User toUserDomain(UserEntity userEntity);

    @Mapping(target = "user", ignore = true)
    UserProfile toUserProfileDomain(UserProfileEntity entity);

    @Mapping(target = "user", ignore = true)
    UserProfileEntity toUserProfileEntity(UserProfile domain);
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/repository/LeagueJpaRepository.java
================================================================================
package com.bughuntersaga.api.infrastructure.persistence.repository;

import com.bughuntersaga.api.infrastructure.persistence.entity.LeagueEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface LeagueJpaRepository extends JpaRepository<LeagueEntity, Integer> {

}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/repository/LessonJpaRepository.java
================================================================================

package com.bughuntersaga.api.infrastructure.persistence.repository;

import com.bughuntersaga.api.infrastructure.persistence.entity.LessonEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;


@Repository
public interface LessonJpaRepository extends JpaRepository<LessonEntity, Integer> {
    /**
     * Obtiene todas las lecciones de una unidad.
     *
     * @param unitId ID de la unidad
     * @return Lista de lecciones ordenadas por posiciÃ³n
     */
    @Query("""
        SELECT l 
        FROM LessonEntity l
        WHERE l.unitId = :unitId
        ORDER BY l.position ASC
        """)
    List<LessonEntity> findByUnitIdOrderByPositionAsc(@Param("unitId") Integer unitId);

}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/repository/ModuleJpaRepository.java
================================================================================

package com.bughuntersaga.api.infrastructure.persistence.repository;

import com.bughuntersaga.api.infrastructure.persistence.entity.ModuleEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.Optional;


@Repository
public interface ModuleJpaRepository extends JpaRepository<ModuleEntity, Integer> {
    /**
     * Busca un mÃ³dulo por su cÃ³digo Ãºnico.
     *
     * @param code CÃ³digo del mÃ³dulo (ej. "mod-a")
     * @return Optional con la entidad si existe
     */
    Optional<ModuleEntity> findByCode(String code);
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/repository/ProblemJpaRepository.java
================================================================================

package com.bughuntersaga.api.infrastructure.persistence.repository;

import com.bughuntersaga.api.infrastructure.persistence.entity.ProblemEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;


@Repository
public interface ProblemJpaRepository extends JpaRepository<ProblemEntity, Integer> {

    /**
     * Obtiene todos los problemas de un mÃ³dulo.
     * JOIN: problems -> lessons -> units -> modules
     */
    @Query("""
        SELECT p 
        FROM ProblemEntity p
        JOIN LessonEntity l ON p.lessonId = l.id
        JOIN UnitEntity u ON l.unitId = u.id
        JOIN ModuleEntity m ON u.moduleId = m.id
        WHERE m.code = :moduleCode
        ORDER BY u.unitNumber ASC, l.position ASC, p.position ASC
        """)
    List<ProblemEntity> findProblemsByModuleCode(@Param("moduleCode") String moduleCode);

    /**
     * Obtiene problemas de una lecciÃ³n especÃ­fica.
     */
    @Query("""
        SELECT p 
        FROM ProblemEntity p
        WHERE p.lessonId = :lessonId
        ORDER BY p.position ASC
        """)
    List<ProblemEntity> findByLessonIdOrderByPositionAsc(@Param("lessonId") Integer lessonId);

}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/repository/ShopItemJpaRepository.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.repository;

    import com.bughuntersaga.api.infrastructure.persistence.entity.ShopItemEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;



    @Repository
public interface ShopItemJpaRepository extends JpaRepository<ShopItemEntity, Integer> {

        // Contenido de la interfaz

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/repository/UnitJpaRepository.java
================================================================================

package com.bughuntersaga.api.infrastructure.persistence.repository;

import com.bughuntersaga.api.infrastructure.persistence.entity.UnitEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;


@Repository
public interface UnitJpaRepository extends JpaRepository<UnitEntity, Integer> {
    /**
     * Obtiene la primera unidad de un mÃ³dulo (ordenada por unit_number).
     *
     * SOLUCIÃ“N: Usar stream().findFirst() para obtener solo el primer resultado.
     *
     * @param moduleCode CÃ³digo del mÃ³dulo
     * @return Primera unidad si existe
     */
    @Query("""
        SELECT u 
        FROM UnitEntity u
        JOIN ModuleEntity m ON u.moduleId = m.id
        WHERE m.code = :moduleCode
        ORDER BY u.unitNumber ASC
        """)
    List<UnitEntity> findByModuleCodeOrderByUnitNumber(@Param("moduleCode") String moduleCode);

    /**
     * Obtiene todas las unidades de un mÃ³dulo.
     *
     * @param moduleCode CÃ³digo del mÃ³dulo
     * @return Lista de unidades ordenadas por nÃºmero
     */
    @Query("""
        SELECT u 
        FROM UnitEntity u
        JOIN ModuleEntity m ON u.moduleId = m.id
        WHERE m.code = :moduleCode
        ORDER BY u.unitNumber ASC
        """)
    List<UnitEntity> findByModuleCode(@Param("moduleCode") String moduleCode);

}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/repository/UserJpaRepository.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.repository;

    import com.bughuntersaga.api.infrastructure.persistence.entity.UserEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import java.util.UUID;


    @Repository
public interface UserJpaRepository extends JpaRepository<UserEntity, UUID> {

        // Contenido de la interfaz

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/repository/UserLessonProgressJpaRepository.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.repository;

    import com.bughuntersaga.api.infrastructure.persistence.entity.UserLessonProgressEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import com.bughuntersaga.api.infrastructure.persistence.entity.UserLessonProgressId;


    @Repository
public interface UserLessonProgressJpaRepository extends JpaRepository<UserLessonProgressEntity, UserLessonProgressId> {

        // Contenido de la interfaz

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/repository/UserProfileJpaRepository.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.repository;

    import com.bughuntersaga.api.infrastructure.persistence.entity.UserProfileEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import java.util.UUID;


    @Repository
public interface UserProfileJpaRepository extends JpaRepository<UserProfileEntity, UUID> {

        // Contenido de la interfaz

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/repository/UserRepository.java
================================================================================
package com.bughuntersaga.api.infrastructure.persistence.repository;

import com.bughuntersaga.api.domain.model.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import java.util.Optional;
import java.util.UUID;

@Repository
public interface UserRepository extends JpaRepository<User, UUID> {
    Optional<User> findByUsername(String username);

    Optional<User> findByEmail(String email);

    Optional<User> findByUsernameOrEmail(String username, String email);
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/repository/UserStreakJpaRepository.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.repository;

    import com.bughuntersaga.api.infrastructure.persistence.entity.UserStreakEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import com.bughuntersaga.api.infrastructure.persistence.entity.UserStreakId;


    @Repository
public interface UserStreakJpaRepository extends JpaRepository<UserStreakEntity, UserStreakId> {

        // Contenido de la interfaz

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/persistence/repository/UserXpHistoryJpaRepository.java
================================================================================

    package com.bughuntersaga.api.infrastructure.persistence.repository;

    import com.bughuntersaga.api.infrastructure.persistence.entity.UserXpHistoryEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;



    @Repository
public interface UserXpHistoryJpaRepository extends JpaRepository<UserXpHistoryEntity, Long> {

        // Contenido de la interfaz

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/security/adapter/JwtTokenGeneratorAdapter.java
================================================================================

    package com.bughuntersaga.api.infrastructure.security.adapter;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Component;
import com.bughuntersaga.api.application.port.out.TokenGeneratorPort;


    @Component
@RequiredArgsConstructor
    public class JwtTokenGeneratorAdapter implements TokenGeneratorPort {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/security/adapter/SpringPasswordEncoderAdapter.java
================================================================================

    package com.bughuntersaga.api.infrastructure.security.adapter;

    import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Component;
import com.bughuntersaga.api.application.port.out.PasswordEncoderPort;


    @Component
@RequiredArgsConstructor
    public class SpringPasswordEncoderAdapter implements PasswordEncoderPort {

    // Contenido de la clase

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/security/config/SecurityConfiguration.java
================================================================================

package com.bughuntersaga.api.infrastructure.security.config;

import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
import com.bughuntersaga.api.infrastructure.security.filter.JwtAuthenticationFilter;

@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfiguration {

    private final JwtAuthenticationFilter jwtAuthenticationFilter;

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .cors(cors -> cors.configurationSource(corsConfigurationSource()))
                .csrf(csrf -> csrf.disable())
                .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .authorizeHttpRequests(auth -> auth
                        .requestMatchers("/api/auth/**").permitAll()
                        .requestMatchers(
                                "/",
                                "/swagger-ui.html",
                                "/swagger-ui/**",
                                "/v3/api-docs/**")
                        .permitAll()
                        .requestMatchers("/api/content/modules").permitAll()
                        .anyRequest().authenticated())
                .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(java.util.Arrays.asList(
                "http://localhost:3000",
                "http://localhost:3002",
                "http://localhost:8080",
                "http://localhost:8081"));
        configuration.setAllowedMethods(java.util.Arrays.asList("GET", "POST", "PUT", "DELETE", "OPTIONS", "PATCH"));
        configuration.setAllowedHeaders(java.util.Arrays.asList("*"));
        configuration.setAllowCredentials(false);
        configuration.setMaxAge(3600L);

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", configuration);
        return source;
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/security/filter/JwtAuthenticationFilter.java
================================================================================
package com.bughuntersaga.api.infrastructure.security.filter;

import lombok.RequiredArgsConstructor;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;
import com.bughuntersaga.api.infrastructure.security.jwt.JwtUtil;

import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;

@Component
@RequiredArgsConstructor
public class JwtAuthenticationFilter extends OncePerRequestFilter {

    private final JwtUtil jwtUtil;

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
            throws ServletException, IOException {

        try {
            String authHeader = request.getHeader("Authorization");
            String token = null;
            String username = null;

            if (authHeader != null && authHeader.startsWith("Bearer ")) {
                token = authHeader.substring(7);
                username = jwtUtil.extractUsername(token);
            }

            if (username != null && SecurityContextHolder.getContext().getAuthentication() == null) {
                if (jwtUtil.isTokenValid(token)) {
                    UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(
                            username, null, null);
                    authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
                    SecurityContextHolder.getContext().setAuthentication(authentication);
                }
            }
        } catch (Exception e) {
            // Log error if needed, continue with filter chain
        }

        filterChain.doFilter(request, response);
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/security/jwt/JwtUtil.java
================================================================================
package com.bughuntersaga.api.infrastructure.security.jwt;

import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.security.Keys;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;
import java.nio.charset.StandardCharsets;
import java.util.Date;

@Component
public class JwtUtil {

    private final String secretKey;
    private final long expirationMs;

    public JwtUtil(
            @Value("${app.jwt.secret:your-secret-key-must-be-at-least-256-bits-long-for-hs256}") String secretKey,
            @Value("${app.jwt.expiration:86400000}") long expirationMs) {
        this.secretKey = secretKey;
        this.expirationMs = expirationMs;
    }

    public String generateToken(String username) {
        return Jwts.builder()
                .subject(username)
                .issuedAt(new Date())
                .expiration(new Date(System.currentTimeMillis() + expirationMs))
                .signWith(Keys.hmacShaKeyFor(secretKey.getBytes(StandardCharsets.UTF_8)))
                .compact();
    }

    public String extractUsername(String token) {
        try {
            return Jwts.parser()
                    .verifyWith(Keys.hmacShaKeyFor(secretKey.getBytes(StandardCharsets.UTF_8)))
                    .build()
                    .parseSignedClaims(token)
                    .getPayload()
                    .getSubject();
        } catch (Exception e) {
            return null;
        }
    }

    public boolean isTokenValid(String token) {
        try {
            Jwts.parser()
                    .verifyWith(Keys.hmacShaKeyFor(secretKey.getBytes(StandardCharsets.UTF_8)))
                    .build()
                    .parseSignedClaims(token);
            return true;
        } catch (Exception e) {
            return false;
        }
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/controller/AuthController.java
================================================================================
package com.bughuntersaga.api.infrastructure.web.controller;

import com.bughuntersaga.api.application.dto.RegisterUserCommand;
import com.bughuntersaga.api.application.port.in.RegisterUserUseCase;
import com.bughuntersaga.api.domain.exception.EmailAlreadyExistsException;
import com.bughuntersaga.api.domain.exception.UsernameAlreadyExistsException;
import com.bughuntersaga.api.domain.model.AuthToken;
import com.bughuntersaga.api.infrastructure.web.dto.UserRegistrationDTO;
import com.bughuntersaga.api.infrastructure.web.mapper.AuthApiMapper;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import com.bughuntersaga.api.application.service.LoginUserService;
import com.bughuntersaga.api.infrastructure.web.dto.UserLoginDTO;
import com.bughuntersaga.api.infrastructure.web.dto.AuthResponseDTO;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/auth")
public class AuthController {

    private final RegisterUserUseCase registerUserUseCase;
    private final LoginUserService loginUserService;
    private final AuthApiMapper authApiMapper;

    @PostMapping("/register")
    public ResponseEntity<AuthResponseDTO> register(@Valid @RequestBody UserRegistrationDTO request) {
        try {
            RegisterUserCommand command = authApiMapper.toRegisterCommand(request);
            AuthToken authToken = registerUserUseCase.register(command);
            AuthResponseDTO response = authApiMapper.toAuthResponseDTO(authToken);
            return ResponseEntity.status(HttpStatus.CREATED).body(response);
        } catch (UsernameAlreadyExistsException | EmailAlreadyExistsException e) {
            return ResponseEntity.status(HttpStatus.BAD_REQUEST).build();
        }
    }

    @PostMapping("/login")
    public ResponseEntity<AuthResponseDTO> login(@RequestBody UserLoginDTO request) {
        try {
            AuthResponseDTO response = loginUserService.login(request);
            return ResponseEntity.ok(response);
        } catch (IllegalArgumentException e) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
        }
    }
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/controller/ContentController.java
================================================================================
package com.bughuntersaga.api.infrastructure.web.controller;

import com.bughuntersaga.api.application.port.in.GetModuleProblemsUseCase;
import com.bughuntersaga.api.application.port.in.GetModuleUnitUseCase;
import com.bughuntersaga.api.application.port.in.GetModulesUseCase;
import com.bughuntersaga.api.domain.model.Module;
import com.bughuntersaga.api.domain.model.Problem;
import com.bughuntersaga.api.domain.model.Unit;
import com.bughuntersaga.api.infrastructure.web.dto.ModuleResponseDTO;
import com.bughuntersaga.api.infrastructure.web.dto.ProblemDTO;
import com.bughuntersaga.api.infrastructure.web.dto.UnitDetailDTO;
import com.bughuntersaga.api.infrastructure.web.mapper.ContentApiMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;
import java.util.stream.Collectors;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/content/modules")
public class ContentController {

    private final ContentApiMapper contentApiMapper;
    private final GetModulesUseCase getModulesUseCase;
    private final GetModuleProblemsUseCase getModuleProblemsUseCase;
    private final GetModuleUnitUseCase getModuleUnitUseCase;


    @GetMapping("")
    public ResponseEntity<List<ModuleResponseDTO>> getModules() {
        List<Module> modules = getModulesUseCase.getModules();
        List<ModuleResponseDTO> moduleResponseDTOs = modules.stream().map(contentApiMapper::toModuleResponseDTO)
                .collect(Collectors.toList());
        return ResponseEntity.ok(moduleResponseDTOs);
    }

    @GetMapping("/{moduleCode}/problems")
    public ResponseEntity<List<ProblemDTO>> getProblemsByModule(@PathVariable("moduleCode") String moduleCode) {
        List<Problem> problems = getModuleProblemsUseCase.getModuleProblems(moduleCode);
        List<ProblemDTO> problemDTOS = problems.stream().map(contentApiMapper::toProblemDTO)
                .collect(Collectors.toList());
        return ResponseEntity.ok(problemDTOS);
    }


    @GetMapping("/{moduleCode}/unit")
    public ResponseEntity<UnitDetailDTO> getUnitsByModule(@PathVariable("moduleCode") String moduleCode) {
        // Ejecutar caso de uso
        Unit unit = getModuleUnitUseCase.getModuleUnit(moduleCode);

        // Convertir a DTO
        UnitDetailDTO response = contentApiMapper.toUnitDTO(unit);
        return ResponseEntity.ok(response);
    }

}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/controller/GamificationController.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.controller;

    import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;
import com.bughuntersaga.api.application.port.in.*;


    @RestController
@RequiredArgsConstructor
    public class GamificationController {

    private final com.bughuntersaga.api.application.port.in.GetLeaderboardUseCase getLeaderboardUseCase;
    private final com.bughuntersaga.api.application.port.in.GetShopItemsUseCase getShopItemsUseCase;
    private final com.bughuntersaga.api.application.port.in.PurchaseItemUseCase purchaseItemUseCase;

    // TODO: Implementar endpoints de OpenAPI
    // @GetMapping("/leaderboard") ...
    // @GetMapping("/shop/items") ...
    // @PostMapping("/shop/purchase/{itemId}") ...

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/controller/ProgressController.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.controller;

    import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;
import com.bughuntersaga.api.application.port.in.*;


    @RestController
@RequiredArgsConstructor
@RequestMapping("/progress")
    public class ProgressController {

    private final com.bughuntersaga.api.application.port.in.CompleteLessonUseCase completeLessonUseCase;
    private final com.bughuntersaga.api.application.port.in.ClaimTreasureUseCase claimTreasureUseCase;

    // TODO: Implementar endpoints de OpenAPI
    // @PostMapping("/lesson") ...
    // @PostMapping("/treasure/{lessonId}") ...

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/controller/SwaggerRedirectController.java
================================================================================
package com.bughuntersaga.api.infrastructure.web.controller;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.servlet.view.RedirectView;

@Controller
public class SwaggerRedirectController {

    @GetMapping("/")
    public RedirectView redirectToSwaggerUi() {
        return new RedirectView("/swagger-ui.html", true);
    }
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/controller/UserController.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.controller;

    import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;
import com.bughuntersaga.api.application.port.in.*;


    @RestController
@RequiredArgsConstructor
@RequestMapping("/users")
    public class UserController {

    private final com.bughuntersaga.api.application.port.in.GetUserProfileUseCase getUserProfileUseCase;
    private final com.bughuntersaga.api.application.port.in.UpdateUserAccountUseCase updateUserAccountUseCase;
    private final com.bughuntersaga.api.application.port.in.UpdateUserSettingsUseCase updateUserSettingsUseCase;
    private final com.bughuntersaga.api.application.port.in.GetUserStatsUseCase getUserStatsUseCase;

    // TODO: Implementar endpoints de OpenAPI
    // @GetMapping("/me/profile") ...
    // @PutMapping("/me/account") ...
    // @PutMapping("/me/settings") ...
    // @GetMapping("/me/stats") ...

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/AuthResponseDTO.java
================================================================================

package com.bughuntersaga.api.infrastructure.web.dto;

import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;

@JsonInclude(JsonInclude.Include.NON_NULL)

/**
 * DTO para AuthResponseDTO.
 * Schema: AuthResponseDTO de OpenAPI
 */
public record AuthResponseDTO(
        // Schema: AuthResponseDTO de OpenAPI
        String token,
        UserInfoDTO user) {
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/ErrorDTO.java
================================================================================

package com.bughuntersaga.api.infrastructure.web.dto;


import com.fasterxml.jackson.annotation.JsonInclude;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@JsonInclude(JsonInclude.Include.NON_NULL)
public class ErrorDTO {
    private LocalDateTime timestamp;
    private Integer status;
    private String error;
    private String message;
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/ForgotPasswordDTO.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.dto;

    import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;
@JsonInclude(JsonInclude.Include.NON_NULL)

    /**
     * DTO para ForgotPasswordDTO.
     * Schema: ForgotPasswordDTO de OpenAPI
     */
    public record ForgotPasswordDTO(
        // TODO: Definir campos basados en el OpenAPI
        // Schema: ForgotPasswordDTO de OpenAPI
    ) {
    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/LeaderboardDTO.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.dto;

    import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;
@JsonInclude(JsonInclude.Include.NON_NULL)

    /**
     * DTO para LeaderboardDTO.
     * Schema: LeaderboardDTO de OpenAPI
     */
    public record LeaderboardDTO(
        // TODO: Definir campos basados en el OpenAPI
        // Schema: LeaderboardDTO de OpenAPI
    ) {
    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/LeaderboardEntryDTO.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.dto;

    import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;
@JsonInclude(JsonInclude.Include.NON_NULL)

    /**
     * DTO para LeaderboardEntryDTO.
     * Schema: LeaderboardEntryDTO de OpenAPI
     */
    public record LeaderboardEntryDTO(
        // TODO: Definir campos basados en el OpenAPI
        // Schema: LeaderboardEntryDTO de OpenAPI
    ) {
    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/LessonCompletionResponseDTO.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.dto;

    import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;
@JsonInclude(JsonInclude.Include.NON_NULL)

    /**
     * DTO para LessonCompletionResponseDTO.
     * Schema: LessonCompletionResponseDTO de OpenAPI
     */
    public record LessonCompletionResponseDTO(
        // TODO: Definir campos basados en el OpenAPI
        // Schema: LessonCompletionResponseDTO de OpenAPI
    ) {
    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/LessonResultDTO.java
================================================================================

package com.bughuntersaga.api.infrastructure.web.dto;

import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;
@JsonInclude(JsonInclude.Include.NON_NULL)

/**
 * DTO para LessonResultDTO.
 * Schema: LessonResultDTO de OpenAPI
 */
public record LessonResultDTO(
        @NotNull(message = "Lesson ID is required")
        @Min(value = 1, message = "Lesson ID must be positive")
        Integer lessonId,

        @NotNull(message = "Correct answer count is required")
        @Min(value = 0, message = "Correct answer count cannot be negative")
        Integer correctAnswerCount,

        @NotNull(message = "Incorrect answer count is required")
        @Min(value = 0, message = "Incorrect answer count cannot be negative")
        Integer incorrectAnswerCount,

        @NotNull(message = "Time taken is required")
        @Min(value = 0, message = "Time taken cannot be negative")
        Long timeTakenMs,

        @NotNull(message = "Is practice flag is required")
        Boolean isPractice
) {
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/LessonTileDTO.java
================================================================================

package com.bughuntersaga.api.infrastructure.web.dto;

import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;
@JsonInclude(JsonInclude.Include.NON_NULL)

/**
 * DTO para LessonTileDTO.
 * Schema: LessonTileDTO de OpenAPI
 */
public record LessonTileDTO(
        Integer lessonId,
        String type,           // "star", "book", "trophy", "treasure", "fast-forward"
        String description,
        String status
) {
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/ModuleResponseDTO.java
================================================================================

package com.bughuntersaga.api.infrastructure.web.dto;

import com.fasterxml.jackson.annotation.JsonInclude;

import java.util.Map;

@JsonInclude(JsonInclude.Include.NON_NULL)

/**
 * DTO para ModuleSummaryDTO.
 * Schema: ModuleSummaryDTO de OpenAPI
 */
public record ModuleResponseDTO(
        Integer id,
        String code,
        String name,
        String description,
        Map<String, Object> uiConfig

) {
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/ProblemDTO.java
================================================================================

package com.bughuntersaga.api.infrastructure.web.dto;

import com.fasterxml.jackson.annotation.JsonInclude;

import java.util.List;

/**
 * DTO de respuesta para problema.
 * Campos nulos no aparecen en el JSON.
 */
@JsonInclude(JsonInclude.Include.NON_NULL)
public record ProblemDTO(
        String type,

        // Campos para tipo INFO
        String moduleTitle,
        String introduction,
        List<String> objectives,

        // Campos para preguntas
        String question,

        // Campos para SELECT_1_OF_3
        List<AnswerOption> answers,
        Integer correctAnswer,

        // Campos para FILL_IN_THE_BLANK
        List<String> answerTiles,
        List<Integer> correctAnswerIndices
) {
    public record AnswerOption(String name) {}
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/ShopItemDTO.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.dto;

    import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;
@JsonInclude(JsonInclude.Include.NON_NULL)

    /**
     * DTO para ShopItemDTO.
     * Schema: ShopItemDTO de OpenAPI
     */
    public record ShopItemDTO(
        // TODO: Definir campos basados en el OpenAPI
        // Schema: ShopItemDTO de OpenAPI
    ) {
    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/UnitDetailDTO.java
================================================================================

package com.bughuntersaga.api.infrastructure.web.dto;

import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;

import java.util.List;

@JsonInclude(JsonInclude.Include.NON_NULL)

/**
 * DTO para UnitDetailDTO.
 * Schema: UnitDetailDTO de OpenAPI
 */
public record UnitDetailDTO(
        Integer unitNumber,
        String description,
        String backgroundColor,
        String textColor,
        String borderColor,
        List<LessonTileDTO> tiles
) {
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/UserAccountUpdateDTO.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.dto;

    import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;
@JsonInclude(JsonInclude.Include.NON_NULL)

    /**
     * DTO para UserAccountUpdateDTO.
     * Schema: UserAccountUpdateDTO de OpenAPI
     */
    public record UserAccountUpdateDTO(
        // TODO: Definir campos basados en el OpenAPI
        // Schema: UserAccountUpdateDTO de OpenAPI
    ) {
    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/UserInfoDTO.java
================================================================================

package com.bughuntersaga.api.infrastructure.web.dto;

import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;

@JsonInclude(JsonInclude.Include.NON_NULL)

/**
 * DTO para UserInfoDTO.
 * Schema: UserInfoDTO de OpenAPI
 */
public record UserInfoDTO(
        // Schema: UserInfoDTO de OpenAPI
        String id,
        String username,
        String name,
        String email) {
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/UserLoginDTO.java
================================================================================

package com.bughuntersaga.api.infrastructure.web.dto;

import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;

@JsonInclude(JsonInclude.Include.NON_NULL)

/**
 * DTO para UserLoginDTO.
 * Schema: UserLoginDTO de OpenAPI
 */
public record UserLoginDTO(
        // Schema: UserLoginDTO de OpenAPI
        String emailOrUsername,
        String password) {
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/UserProfileDTO.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.dto;

    import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;
@JsonInclude(JsonInclude.Include.NON_NULL)

    /**
     * DTO para UserProfileDTO.
     * Schema: UserProfileDTO de OpenAPI
     */
    public record UserProfileDTO(
        // TODO: Definir campos basados en el OpenAPI
        // Schema: UserProfileDTO de OpenAPI
    ) {
    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/UserRegistrationDTO.java
================================================================================
package com.bughuntersaga.api.infrastructure.web.dto;

import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;

public record UserRegistrationDTO(
        @NotBlank(message = "El username es obligatorio")
        @Size(min = 3, message = "El username debe tener al menos 3 caracteres")
        String username,

        @NotBlank(message = "El nombre es obligatorio")
        String name,

        @NotBlank(message = "El email es obligatorio")
        @Email(message = "El email debe ser vÃ¡lido")
        String email,

        @NotBlank(message = "La contraseÃ±a es obligatoria")
        @Size(min = 8, message = "La contraseÃ±a debe tener al menos 8 caracteres")
        String password
) {}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/UserSettingsUpdateDTO.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.dto;

    import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;
@JsonInclude(JsonInclude.Include.NON_NULL)

    /**
     * DTO para UserSettingsUpdateDTO.
     * Schema: UserSettingsUpdateDTO de OpenAPI
     */
    public record UserSettingsUpdateDTO(
        // TODO: Definir campos basados en el OpenAPI
        // Schema: UserSettingsUpdateDTO de OpenAPI
    ) {
    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/dto/UserStatsDTO.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.dto;

    import jakarta.validation.constraints.*;
import com.fasterxml.jackson.annotation.JsonInclude;
@JsonInclude(JsonInclude.Include.NON_NULL)

    /**
     * DTO para UserStatsDTO.
     * Schema: UserStatsDTO de OpenAPI
     */
    public record UserStatsDTO(
        // TODO: Definir campos basados en el OpenAPI
        // Schema: UserStatsDTO de OpenAPI
    ) {
    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/exception/GlobalApiExceptionHandler.java
================================================================================

package com.bughuntersaga.api.infrastructure.web.exception;

import com.bughuntersaga.api.domain.exception.*;
import com.bughuntersaga.api.infrastructure.web.dto.ErrorDTO;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.validation.FieldError;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import java.time.LocalDateTime;
import java.util.stream.Collectors;

/**
 * Manejador global de excepciones para la API.
 *
 * Responsabilidades:
 * - Capturar excepciones de dominio y convertirlas en respuestas HTTP
 * - Capturar excepciones de validaciÃ³n de Spring
 * - Retornar ErrorDTO segÃºn el contrato de la API
 * - Proporcionar mensajes de error consistentes
 */
@RestControllerAdvice
public class GlobalApiExceptionHandler {

    /**
     * Maneja UserAlreadyExistsException (400 Bad Request).
     */
    @ExceptionHandler(UsernameAlreadyExistsException.class)
    public ResponseEntity<ErrorDTO> handleUserAlreadyExists(UsernameAlreadyExistsException ex) {
        ErrorDTO error = ErrorDTO.builder()
                .timestamp(LocalDateTime.now())
                .status(HttpStatus.BAD_REQUEST.value())
                .error("Bad Request")
                .message(ex.getMessage())
                .build();

        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(error);
    }

    /**
     * Maneja InvalidCredentialsException (401 Unauthorized).
     */
    @ExceptionHandler(InvalidCredentialsException.class)
    public ResponseEntity<ErrorDTO> handleInvalidCredentials(InvalidCredentialsException ex) {
        ErrorDTO error = ErrorDTO.builder()
                .timestamp(LocalDateTime.now())
                .status(HttpStatus.UNAUTHORIZED.value())
                .error("Unauthorized")
                .message(ex.getMessage())
                .build();

        return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(error);
    }

    /**
     * Maneja ResourceNotFoundException (404 Not Found).
     */
    @ExceptionHandler(ResourceNotFoundException.class)
    public ResponseEntity<ErrorDTO> handleResourceNotFound(ResourceNotFoundException ex) {
        ErrorDTO error = ErrorDTO.builder()
                .timestamp(LocalDateTime.now())
                .status(HttpStatus.NOT_FOUND.value())
                .error("Not Found")
                .message(ex.getMessage())
                .build();

        return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);
    }

    // ========================================================================
    // NUEVOS HANDLERS PARA FASE 3: Registrar Progreso
    // ========================================================================

    /**
     * Maneja LessonNotFoundException (404 Not Found).
     * Se lanza cuando se intenta completar una lecciÃ³n que no existe.
     */
    @ExceptionHandler(LessonNotFoundException.class)
    public ResponseEntity<ErrorDTO> handleLessonNotFound(LessonNotFoundException ex) {
        ErrorDTO error = ErrorDTO.builder()
                .timestamp(LocalDateTime.now())
                .status(HttpStatus.NOT_FOUND.value())
                .error("Not Found")
                .message(ex.getMessage())
                .build();

        return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);
    }

    /**
     * Maneja LessonAlreadyCompletedException (409 Conflict).
     * Se lanza cuando un usuario intenta completar una lecciÃ³n que ya completÃ³ previamente.
     */
    @ExceptionHandler(LessonAlreadyCompletedException.class)
    public ResponseEntity<ErrorDTO> handleLessonAlreadyCompleted(LessonAlreadyCompletedException ex) {
        ErrorDTO error = ErrorDTO.builder()
                .timestamp(LocalDateTime.now())
                .status(HttpStatus.CONFLICT.value())
                .error("Conflict")
                .message(ex.getMessage())
                .build();

        return ResponseEntity.status(HttpStatus.CONFLICT).body(error);
    }


    // ========================================================================
    // HANDLERS GENÃ‰RICOS (YA EXISTENTES)
    // ========================================================================

    /**
     * Maneja errores de validaciÃ³n de Spring (400 Bad Request).
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ErrorDTO> handleValidationErrors(MethodArgumentNotValidException ex) {
        String message = ex.getBindingResult().getFieldErrors().stream()
                .map(FieldError::getDefaultMessage)
                .collect(Collectors.joining(", "));

        ErrorDTO error = ErrorDTO.builder()
                .timestamp(LocalDateTime.now())
                .status(HttpStatus.BAD_REQUEST.value())
                .error("Validation Error")
                .message(message)
                .build();

        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(error);
    }

    /**
     * Maneja cualquier otra excepciÃ³n no capturada (500 Internal Server Error).
     */
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorDTO> handleGenericException(Exception ex) {
        ErrorDTO error = ErrorDTO.builder()
                .timestamp(LocalDateTime.now())
                .status(HttpStatus.INTERNAL_SERVER_ERROR.value())
                .error("Internal Server Error")
                .message("Ha ocurrido un error inesperado: " + ex.getMessage())
                .build();

        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(error);
    }
}

================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/mapper/AuthApiMapper.java
================================================================================
package com.bughuntersaga.api.infrastructure.web.mapper;

import com.bughuntersaga.api.application.dto.RegisterUserCommand;
import com.bughuntersaga.api.domain.model.AuthToken;
import com.bughuntersaga.api.domain.model.User;
import com.bughuntersaga.api.infrastructure.web.dto.AuthResponseDTO;
import com.bughuntersaga.api.infrastructure.web.dto.UserInfoDTO;
import com.bughuntersaga.api.infrastructure.web.dto.UserRegistrationDTO;
import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.ReportingPolicy;

@Mapper(componentModel = "spring", unmappedTargetPolicy = ReportingPolicy.IGNORE)
public interface AuthApiMapper {

    // Mapeo de DTO a Comando
    @Mapping(source = "password", target = "rawPassword")
    RegisterUserCommand toRegisterCommand(UserRegistrationDTO dto);

    // Mapeo de AuthToken a DTO de respuesta
    AuthResponseDTO toAuthResponseDTO(AuthToken authToken);

    // Info bÃ¡sica del usuario
    @Mapping(source = "id", target = "id")
    UserInfoDTO toUserInfoDTO(User user);
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/mapper/ContentApiMapper.java
================================================================================

package com.bughuntersaga.api.infrastructure.web.mapper;

import com.bughuntersaga.api.domain.model.Lesson;
import com.bughuntersaga.api.domain.model.Problem;
import com.bughuntersaga.api.domain.model.Unit;
import com.bughuntersaga.api.infrastructure.web.dto.LessonTileDTO;
import com.bughuntersaga.api.infrastructure.web.dto.ModuleResponseDTO;
import com.bughuntersaga.api.domain.model.Module;
import com.bughuntersaga.api.infrastructure.web.dto.ProblemDTO;
import com.bughuntersaga.api.infrastructure.web.dto.UnitDetailDTO;
import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.ReportingPolicy;

import java.util.stream.Collectors;


@Mapper(componentModel = "spring", unmappedTargetPolicy = ReportingPolicy.IGNORE)
public interface ContentApiMapper {


    ModuleResponseDTO toModuleResponseDTO(Module module);
    UnitDetailDTO toUnitDetailDTO(Unit unit);

    @Mapping(target = "answers", expression = "java(mapAnswers(problem))")
    ProblemDTO toProblemDTO(Problem problem);

    default java.util.List<ProblemDTO.AnswerOption> mapAnswers(Problem problem) {
        if (problem.getAnswers() == null) return null;
        return problem.getAnswers().stream()
                .map(answer -> new ProblemDTO.AnswerOption(answer.getName()))
                .collect(Collectors.toList());
    }
    /**
     * Convierte Unit â†’ UnitDTO.
     *
     * NOTA: Los colores (backgroundColor, textColor, borderColor)
     * no estÃ¡n en el dominio Unit. Deben ser configurados
     * manualmente o venir del mÃ³dulo.
     */
    @Mapping(target = "backgroundColor", constant = "bg-blue-500")
    @Mapping(target = "textColor", constant = "text-white")
    @Mapping(target = "borderColor", constant = "border-blue-700")
    @Mapping(target = "tiles", source = "lessons")
    UnitDetailDTO toUnitDTO(Unit unit);

    /**
     * Convierte Lesson â†’ LessonTileDTO.
     */
    @Mapping(target = "lessonId", source = "id")
    LessonTileDTO toLessonTileDTO(Lesson lesson);
}


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/mapper/GamificationApiMapper.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.mapper;

    import org.mapstruct.Mapper;
import org.mapstruct.ReportingPolicy;


    @Mapper(componentModel = "spring", unmappedTargetPolicy = ReportingPolicy.IGNORE)
public interface GamificationApiMapper {

        // Contenido de la interfaz

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/mapper/ProgressApiMapper.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.mapper;

    import org.mapstruct.Mapper;
import org.mapstruct.ReportingPolicy;


    @Mapper(componentModel = "spring", unmappedTargetPolicy = ReportingPolicy.IGNORE)
public interface ProgressApiMapper {

        // Contenido de la interfaz

    }


================================================================================
ğŸ“„ CONTENIDO DE: infrastructure/web/mapper/UserApiMapper.java
================================================================================

    package com.bughuntersaga.api.infrastructure.web.mapper;

    import org.mapstruct.Mapper;
import org.mapstruct.ReportingPolicy;


    @Mapper(componentModel = "spring", unmappedTargetPolicy = ReportingPolicy.IGNORE)
public interface UserApiMapper {

        // Contenido de la interfaz

    }
